name: Deploy Next.js + Express App

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Print Docker Compose Version
        run: docker compose version

      - name: Checkout Code and Deploy App
        run: |
          cd /home/docker/nextjs-express

          git reset --hard
          git clean -fd
          git fetch origin
          git checkout main
          git pull origin main

          docker compose up -d --build
          docker image prune -f
          docker ps
